<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á—ë—Ç—ã</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        .header {
            background: #667eea;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header a {
            color: white;
            text-decoration: none;
            margin-right: 20px;
        }
        .btn-logout {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 5px;
        }
        .btn-logout:hover {
            background: rgba(255,255,255,0.3);
        }
        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }
        h2 {
            margin-bottom: 30px;
            color: #333;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card h3 {
            color: #667eea;
            font-size: 36px;
            margin-bottom: 10px;
        }
        .stat-card p {
            color: #666;
            font-size: 14px;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .chart-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-box.full-width {
            grid-column: 1 / -1;
        }
        .chart-box h3 {
            margin-bottom: 20px;
            color: #333;
        }
        .chart {
            width: 100%;
            height: 350px;
        }
        .empty {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            background: white;
            border-radius: 10px;
        }
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <a href="/dashboard">‚Üê –ù–∞–∑–∞–¥</a>
            <span>–û—Ç—á—ë—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
            <a href="/logout" class="btn-logout">üö™ –í—ã–π—Ç–∏</a>
        </div>
    </div>
    
    <div class="container">
        <h2>üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
        
        {{if .dates}}
        <div class="stats">
            <div class="stat-card">
                <h3>{{printf "%.1f" .totalHours}}</h3>
                <p>–í—Å–µ–≥–æ —á–∞—Å–æ–≤</p>
            </div>
            <div class="stat-card">
                <h3>{{.daysCount}}</h3>
                <p>–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</p>
            </div>
            <div class="stat-card">
                <h3>{{printf "%.1f" .avgHours}}</h3>
                <p>–°—Ä–µ–¥–Ω–µ–µ —á–∞—Å–æ–≤/–¥–µ–Ω—å</p>
            </div>
            <div class="stat-card">
                <h3>{{len .months}}</h3>
                <p>–ú–µ—Å—è—Ü–µ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏</p>
            </div>
        </div>
        
        <div class="charts-grid">
            <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–æ –¥–Ω—è–º -->
            <div class="chart-box full-width">
                <h3>üìà –ß–∞—Å—ã –ø–æ –¥–Ω—è–º</h3>
                <div id="chartDays" class="chart"></div>
            </div>
            
            <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–æ –º–µ—Å—è—Ü–∞–º -->
            <div class="chart-box">
                <h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                <div id="chartMonths" class="chart"></div>
            </div>
            
            <!-- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º -->
            <div class="chart-box">
                <h3>üç∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–µ–ª—è–º</h3>
                <div id="chartWeeks" class="chart"></div>
            </div>
            
            <!-- –õ–∏–Ω–µ–π–Ω—ã–π —Ç—Ä–µ–Ω–¥ —Å–æ —Å—Ä–µ–¥–Ω–∏–º -->
            <div class="chart-box full-width">
                <h3>üìâ –¢—Ä–µ–Ω–¥ –∏ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</h3>
                <div id="chartTrend" class="chart"></div>
            </div>
        </div>
        
        <script>
            // –ì—Ä–∞—Ñ–∏–∫ –ø–æ –¥–Ω—è–º (—Å—Ç–æ–ª–±—Ü—ã)
            const chartDays = echarts.init(document.getElementById('chartDays'));
            chartDays.setOption({
                tooltip: { trigger: 'axis' },
                grid: { bottom: 80, left: 50, right: 30 },
                xAxis: {
                    type: 'category',
                    data: {{.dates}},
                    axisLabel: { rotate: 45, fontSize: 10 }
                },
                yAxis: {
                    type: 'value',
                    name: '–ß–∞—Å—ã'
                },
                series: [{
                    data: {{.hours}},
                    type: 'bar',
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#667eea' },
                            { offset: 1, color: '#764ba2' }
                        ])
                    },
                    label: {
                        show: true,
                        position: 'top',
                        fontSize: 10
                    }
                }]
            });
            
            // –ì—Ä–∞—Ñ–∏–∫ –ø–æ –º–µ—Å—è—Ü–∞–º (—Å—Ç–æ–ª–±—Ü—ã)
            const chartMonths = echarts.init(document.getElementById('chartMonths'));
            chartMonths.setOption({
                tooltip: { trigger: 'axis' },
                xAxis: {
                    type: 'category',
                    data: {{.months}},
                    axisLabel: { rotate: 45, fontSize: 11 }
                },
                yAxis: {
                    type: 'value',
                    name: '–ß–∞—Å—ã'
                },
                series: [{
                    data: {{.monthHours}},
                    type: 'bar',
                    itemStyle: { color: '#4CAF50' },
                    label: {
                        show: true,
                        position: 'top'
                    }
                }]
            });
            
            // –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º
            const chartWeeks = echarts.init(document.getElementById('chartWeeks'));
            const weekData = {{.weeks}}.map((week, i) => ({
                name: week,
                value: {{.weekHours}}[i]
            }));
            
            chartWeeks.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c}—á ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    type: 'scroll',
                    pageIconSize: 12
                },
                series: [{
                    type: 'pie',
                    radius: '60%',
                    data: weekData,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            });
            
            // –õ–∏–Ω–µ–π–Ω—ã–π —Ç—Ä–µ–Ω–¥ —Å —Å—Ä–µ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
            const chartTrend = echarts.init(document.getElementById('chartTrend'));
            const avgLine = Array({{len .hours}}).fill({{printf "%.1f" .avgHours}});
            
            chartTrend.setOption({
                tooltip: { trigger: 'axis' },
                legend: {
                    data: ['–ß–∞—Å—ã', '–°—Ä–µ–¥–Ω–µ–µ']
                },
                grid: { bottom: 80, left: 50, right: 30 },
                xAxis: {
                    type: 'category',
                    data: {{.dates}},
                    axisLabel: { rotate: 45, fontSize: 10 }
                },
                yAxis: {
                    type: 'value',
                    name: '–ß–∞—Å—ã'
                },
                series: [
                    {
                        name: '–ß–∞—Å—ã',
                        data: {{.hours}},
                        type: 'line',
                        smooth: true,
                        itemStyle: { color: '#667eea' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(102, 126, 234, 0.3)' },
                                { offset: 1, color: 'rgba(102, 126, 234, 0.05)' }
                            ])
                        }
                    },
                    {
                        name: '–°—Ä–µ–¥–Ω–µ–µ',
                        data: avgLine,
                        type: 'line',
                        itemStyle: { color: '#ff4444' },
                        lineStyle: { type: 'dashed', width: 2 }
                    }
                ]
            });
            
            // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
            window.addEventListener('resize', () => {
                chartDays.resize();
                chartMonths.resize();
                chartWeeks.resize();
                chartTrend.resize();
            });
        </script>
        
        {{else}}
        <div class="empty">
            <h3>üì≠ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á—ë—Ç–∞</h3>
            <p>–î–æ–±–∞–≤—å –∑–∞–ø–∏—Å–∏ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>
        {{end}}
    </div>
</body>
</html>
